<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FreshersHub</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom right, rgba(0, 114, 255, 0.6), rgba(0, 198, 255, 0.6)),
        url('https://images.unsplash.com/photo-1519389950473-47ba0277781c?fit=crop&w=1650&q=80') no-repeat center center;
      background-size: cover;
      background-attachment: fixed;
      color: white;
    }

    .container {
      max-width: 400px;
      margin: 5% auto;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    h2 { text-align: center; margin-bottom: 1.5rem; }

    input, select, button {
      width: 100%; padding: 12px; margin: 8px 0;
      border: none; border-radius: 8px; font-size: 1rem;
    }

    button { 
      background-color: #00c6ff; 
      color: white; 
      cursor: pointer; 
      transition: background 0.3s;
    }
    button:hover { background-color: #1c78e9; }
    button.danger { background-color: #dc3545; }
    button.danger:hover { background-color: #c82333; }
    button.success { background-color: #28a745; }
    button.success:hover { background-color: #218838; }

    /* Dashboard Cards */
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      backdrop-filter: blur(5px);
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
      background: white;
      border-radius: 10px;
      color: black;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: #007bff;
      color: white;
      position: sticky;
      top: 0;
    }
    
    tr:hover {
      background-color: #f5f5f5;
    }

    /* Menu buttons */
    #adminMenuBtn, #fresherMenuBtn, #employerMenuBtn {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 28px;
      cursor: pointer;
      z-index: 1001;
      display: none;
      color: white;
      background: rgba(0,0,0,0.5);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
    }

    /* Side Menus */
    .sideMenu {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background: rgba(0,0,0,0.9);
      color: white;
      padding-top: 60px;
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    
    .sideMenu.open { transform: translateX(250px); }
    
    .sideMenu a {
      display: block;
      color: white;
      padding: 12px 20px;
      text-decoration: none;
      font-size: 18px;
      border-left: 4px solid transparent;
    }
    
    .sideMenu a:hover {
      background: rgba(255,255,255,0.1);
      border-left: 4px solid #00c6ff;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 999;
      display: none;
    }
    
    .overlay.show { display: block; }

    #toggle-text a {
      color: #00aeff; 
      font-weight: bold;
      text-decoration: underline;
      cursor: pointer;
    }

    /* Dashboard sections */
    .dashboard-section {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .stats-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    
    /* Loading spinner */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #00c6ff;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Admin Management Tabs */
    .admin-management-tabs {
      display: flex;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      margin-bottom: 15px;
    }

    .tab-button {
      padding: 10px 20px;
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tab-button:hover {
      background: rgba(255,255,255,0.1);
    }

    .tab-button.active {
      border-bottom: 3px solid #00c6ff;
      color: #00c6ff;
    }

    .admin-tab-content {
      display: none;
    }

    .admin-tab-content.active {
      display: block;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stats-container {
        flex-direction: row;
        justify-content: flex-start;
      }
      .stat-card {
        min-width: 180px;
      }
    }
  </style>
</head>
<body>

  <!-- LOGIN/SIGNUP SECTION -->
  <div class="container" id="auth-section">
    <h2 id="form-title">FreshersHub - Signup</h2>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <select id="role">
      <option value="fresher">Fresher</option>
      <option value="employer">Employer</option>
      <option value="admin">Admin</option>
    </select>
    <button id="actionBtn" onclick="signup()">Signup</button>
    <p id="toggle-text">Already have an account? <a id="toggleLink">Login here</a></p>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="adminDashboard" style="display:none;">
    <div id="adminMenuBtn" onclick="toggleAdminMenu()">☰</div>

    <div class="sideMenu" id="adminSideMenu">
      <a href="#" id="adminMenuHome">Dashboard</a>
      <a href="#" id="adminMenuUsers">Manage Users</a>
      <a href="#" id="adminMenuJobs">Manage Jobs</a>
      <a href="#" id="adminMenuSettings">Settings</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>

    <div class="overlay" id="adminOverlay" onclick="toggleAdminMenu()"></div>

    <!-- Admin Home Section -->
    <div class="dashboard-section" id="adminHomeSection">
      <h2>Admin Dashboard</h2>
      <div class="stats-container horizontal">
        <div class="stat-card">
          <p>Total Freshers</p>
          <h3 id="totalFreshers">-</h3>
        </div>
        <div class="stat-card">
          <p>Total Employers</p>
          <h3 id="totalEmployers">-</h3>
        </div>
        <div class="stat-card">
          <p>Total Jobs</p>
          <h3 id="totalJobs">-</h3>
        </div>
      </div>

      <div class="card">
        <h3 style="text-align: center;">Recent Activity</h3>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
          <div style="flex: 1; min-width: 300px;">
            <h4>Last 5 Users</h4>
            <div class="table-container">
              <table>
                <thead>
                  <tr><th>Email</th><th>Role</th></tr>
                </thead>
                <tbody id="recentUsersTable"></tbody>
              </table>
            </div>
          </div>
          <div style="flex: 1; min-width: 300px;">
            <h4>Last 5 Jobs</h4>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Employer</th>
                    <th>Location</th>
                  </tr>
                </thead>
                <tbody id="recentJobsTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Admin Settings Section -->
    <div class="dashboard-section" id="adminSettingsSection">
      <h2>Admin Settings</h2>
      <button onclick="showAdminSection('home')" style="margin-bottom: 20px;">← Back to Dashboard</button>
      
      <div class="card">
        <h3>Admin Management</h3>
        <div class="admin-management-tabs">
          <button class="tab-button active" onclick="showAdminTab('addAdmin')">Add Admin</button>
          <button class="tab-button" onclick="showAdminTab('manageAdmins')">Current Admins</button>
        </div>
        
        <div id="addAdminTab" class="admin-tab-content" style="display: block;">
          <form id="addAdminForm">
            <input type="email" id="adminEmail" placeholder="Admin Email" required>
            <input type="password" id="adminPassword" placeholder="Temporary Password" required>
            <button type="submit" class="success">Create Admin</button>
          </form>
        </div>
        
        <div id="manageAdminsTab" class="admin-tab-content">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Created At</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="adminsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- EMPLOYER DASHBOARD -->
  <div id="employerDashboard" style="display:none;">
    <div id="employerMenuBtn" onclick="toggleEmployerMenu()">☰</div>
    
    <div class="sideMenu" id="employerSideMenu">
      <a href="#" id="employerMenuHome">Dashboard</a>
      <a href="#" id="employerMenuPostJob">Post Job</a>
      <a href="#" id="employerMenuMyJobs">My Jobs</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
    
    <div class="overlay" id="employerOverlay" onclick="toggleEmployerMenu()"></div>
    
    <!-- Employer Home Section -->
    <div class="dashboard-section" id="employerHomeSection">
      <h2>Employer Dashboard</h2>
      <div class="card">
        <p>Welcome to your Employer dashboard!</p>
      </div>
    </div>
  </div>

  <!-- FRESHER DASHBOARD -->
  <div id="fresherDashboard" style="display:none;">
    <div id="fresherMenuBtn" onclick="toggleFresherMenu()">☰</div>
    
    <div class="sideMenu" id="fresherSideMenu">
      <a href="#" id="fresherMenuHome">Dashboard</a>
      <a href="#" id="fresherMenuJobs">Browse Jobs</a>
      <a href="#" id="fresherMenuApplications">My Applications</a>
      <a href="#" id="fresherMenuProfile">Profile</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
    
    <div class="overlay" id="fresherOverlay" onclick="toggleFresherMenu()"></div>
    
    <!-- Fresher Home Section -->
    <div class="dashboard-section" id="fresherHomeSection">
      <h2>Fresher Dashboard</h2>
      <div class="card">
        <p>Welcome to your job search dashboard!</p>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, setDoc, doc, getDoc, collection, where, getDocs, query, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDrrAYywpFdd9iIzSSp2m6XcrGkGUgYY3Y",
    authDomain: "freshershub-33de8.firebaseapp.com",
    projectId: "freshershub-33de8",
    storageBucket: "freshershub-33de8.appspot.com",
    messagingSenderId: "126389629687",
    appId: "1:126389629687:web:9b9fb43e488f60ac3159f2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Auth Functions
  window.signup = async function() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const role = document.getElementById('role').value.toLowerCase(); // Normalize role

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      await setDoc(doc(db, "users", user.uid), { 
        email, 
        role,
        createdAt: new Date().toISOString()
      });

      alert("Signup successful!");
      showDashboard(role);
    } catch (err) {
      alert(err.message);
    }
  };

  window.login = async function() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const userData = docSnap.data();
        showDashboard(userData.role);
      } else {
        alert("User data not found.");
      }
    } catch (err) {
      alert(err.message);
    }
  };

  window.toggleForm = function() {
    const formTitle = document.getElementById('form-title');
    const actionBtn = document.getElementById('actionBtn');
    const toggleText = document.getElementById('toggle-text');
    const roleSelect = document.getElementById('role');

    if (formTitle.textContent.includes('Signup')) {
      formTitle.textContent = 'FreshersHub - Login';
      actionBtn.textContent = 'Login';
      actionBtn.onclick = login;
      toggleText.innerHTML = `Don't have an account? <a id="toggleLink">Signup here</a>`;
      roleSelect.style.display = 'none';
    } else {
      formTitle.textContent = 'FreshersHub - Signup';
      actionBtn.textContent = 'Signup';
      actionBtn.onclick = signup;
      toggleText.innerHTML = `Already have an account? <a id="toggleLink">Login here</a>`;
      roleSelect.style.display = 'block';
    }

    document.getElementById('toggleLink').addEventListener('click', (e) => {
      e.preventDefault();
      toggleForm();
    });
  };

  window.showDashboard = async function(role) {
    console.log("Showing dashboard for role:", role);
    
    // Hide all dashboards and menus
    document.getElementById('auth-section').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'none';
    document.getElementById('fresherDashboard').style.display = 'none';
    document.getElementById('employerDashboard').style.display = 'none';
    
    document.getElementById('adminMenuBtn').style.display = 'none';
    document.getElementById('fresherMenuBtn').style.display = 'none';
    document.getElementById('employerMenuBtn').style.display = 'none';

    // Show loading state
    const loadingMessage = document.createElement('div');
    loadingMessage.innerHTML = '<div class="spinner"></div><p>Loading dashboard...</p>';
    document.body.appendChild(loadingMessage);

    try {
      // Show relevant dashboard
      if (role === 'admin') {
        document.getElementById('adminDashboard').style.display = 'block';
        document.getElementById('adminMenuBtn').style.display = 'block';
        showAdminSection('home');
      } 
      else if (role === 'fresher') {
        document.getElementById('fresherDashboard').style.display = 'block';
        document.getElementById('fresherMenuBtn').style.display = 'block';
        showFresherSection('home');
      } 
      else if (role === 'employer') {
        document.getElementById('employerDashboard').style.display = 'block';
        document.getElementById('employerMenuBtn').style.display = 'block';
        showEmployerSection('home');
      } 
      else {
        alert("Unknown role: " + role);
        document.getElementById('auth-section').style.display = 'block';
      }
    } catch (error) {
      console.error("Dashboard error:", error);
      alert("Error loading dashboard");
      document.getElementById('auth-section').style.display = 'block';
    } finally {
      document.body.removeChild(loadingMessage);
    }
  };

  // Initialize Event Listeners
  document.addEventListener('DOMContentLoaded', () => {
    // Toggle between login/signup
    document.getElementById('toggleLink').addEventListener('click', (e) => {
      e.preventDefault();
      toggleForm();
    });

    // Check auth state
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) {
          showDashboard(snap.data().role);
        }
      }
    });
  });

  // Dashboard Navigation Functions
window.showAdminSection = function(section) {
  document.getElementById('adminHomeSection').style.display = 'none';
  document.getElementById('adminUsersSection').style.display = 'none';
  document.getElementById('adminJobsSection').style.display = 'none';
  document.getElementById('adminSettingsSection').style.display = 'none';

  if (section === 'home') {
    document.getElementById('adminHomeSection').style.display = 'block';
    loadAdminStats();
    loadRecentActivity();
  } else if (section === 'users') {
    document.getElementById('adminUsersSection').style.display = 'block';
    loadAllUsers();
  } else if (section === 'jobs') {
    document.getElementById('adminJobsSection').style.display = 'block';
    loadAllJobs();
  } else if (section === 'settings') {
    document.getElementById('adminSettingsSection').style.display = 'block';
  }
};

window.showFresherSection = function(section) {
  document.getElementById('fresherHomeSection').style.display = 'none';
  document.getElementById('fresherJobsSection').style.display = 'none';
  document.getElementById('fresherApplicationsSection').style.display = 'none';
  document.getElementById('fresherProfileSection').style.display = 'none';

  if (section === 'home') {
    document.getElementById('fresherHomeSection').style.display = 'block';
  } else if (section === 'jobs') {
    document.getElementById('fresherJobsSection').style.display = 'block';
    loadAvailableJobs();
  } else if (section === 'applications') {
    document.getElementById('fresherApplicationsSection').style.display = 'block';
    loadMyApplications();
  } else if (section === 'profile') {
    document.getElementById('fresherProfileSection').style.display = 'block';
    loadFresherProfile();
  }
};

window.showEmployerSection = function(section) {
  document.getElementById('employerHomeSection').style.display = 'none';
  document.getElementById('employerPostJobSection').style.display = 'none';
  document.getElementById('employerMyJobsSection').style.display = 'none';

  if (section === 'home') {
    document.getElementById('employerHomeSection').style.display = 'block';
  } else if (section === 'postJob') {
    document.getElementById('employerPostJobSection').style.display = 'block';
  } else if (section === 'myJobs') {
    document.getElementById('employerMyJobsSection').style.display = 'block';
    loadEmployerJobs();
  }
};

// Menu Toggle Functions
window.toggleAdminMenu = function() {
  document.getElementById('adminSideMenu').classList.toggle('open');
  document.getElementById('adminOverlay').classList.toggle('show');
};

window.toggleFresherMenu = function() {
  document.getElementById('fresherSideMenu').classList.toggle('open');
  document.getElementById('fresherOverlay').classList.toggle('show');
};

window.toggleEmployerMenu = function() {
  document.getElementById('employerSideMenu').classList.toggle('open');
  document.getElementById('employerOverlay').classList.toggle('show');
};

// Placeholder functions for data loading
window.loadAdminStats = async function() {
  console.log("Loading admin stats...");
  // Implement actual stats loading here
};

window.loadRecentActivity = async function() {
  console.log("Loading recent activity...");
  // Implement activity loading here
};

window.loadAllUsers = async function() {
  console.log("Loading all users...");
  // Implement user loading here
};

window.loadAllJobs = async function() {
  console.log("Loading all jobs...");
  // Implement job loading here
};

window.loadAvailableJobs = function() {
  console.log("Loading available jobs...");
  // Implement available jobs loading here
};

window.loadMyApplications = function() {
  console.log("Loading my applications...");
  // Implement applications loading here
};

window.loadFresherProfile = function() {
  console.log("Loading fresher profile...");
  // Implement profile loading here
};

window.loadEmployerJobs = function() {
  console.log("Loading employer jobs...");
  // Implement employer jobs loading here
};

// Add menu event listeners
document.addEventListener('DOMContentLoaded', () => {
  // Admin menu links
  document.getElementById('adminMenuHome')?.addEventListener('click', (e) => {
    e.preventDefault();
    showAdminSection('home');
    toggleAdminMenu();
  });
  
  document.getElementById('adminMenuUsers')?.addEventListener('click', (e) => {
    e.preventDefault();
    showAdminSection('users');
    toggleAdminMenu();
  });
  
  document.getElementById('adminMenuJobs')?.addEventListener('click', (e) => {
    e.preventDefault();
    showAdminSection('jobs');
    toggleAdminMenu();
  });
  
  document.getElementById('adminMenuSettings')?.addEventListener('click', (e) => {
    e.preventDefault();
    showAdminSection('settings');
    toggleAdminMenu();
  });

  // Fresher menu links
  document.getElementById('fresherMenuHome')?.addEventListener('click', (e) => {
    e.preventDefault();
    showFresherSection('home');
    toggleFresherMenu();
  });
  
  document.getElementById('fresherMenuJobs')?.addEventListener('click', (e) => {
    e.preventDefault();
    showFresherSection('jobs');
    toggleFresherMenu();
  });
  
  document.getElementById('fresherMenuApplications')?.addEventListener('click', (e) => {
    e.preventDefault();
    showFresherSection('applications');
    toggleFresherMenu();
  });
  
  document.getElementById('fresherMenuProfile')?.addEventListener('click', (e) => {
    e.preventDefault();
    showFresherSection('profile');
    toggleFresherMenu();
  });

  // Employer menu links
  document.getElementById('employerMenuHome')?.addEventListener('click', (e) => {
    e.preventDefault();
    showEmployerSection('home');
    toggleEmployerMenu();
  });
  
  document.getElementById('employerMenuPostJob')?.addEventListener('click', (e) => {
    e.preventDefault();
    showEmployerSection('postJob');
    toggleEmployerMenu();
  });
  
  document.getElementById('employerMenuMyJobs')?.addEventListener('click', (e) => {
    e.preventDefault();
    showEmployerSection('myJobs');
    toggleEmployerMenu();
  });
});
</script>
</body>
</html>
