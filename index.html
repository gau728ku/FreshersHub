<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FreshersHub - Job Portal</title>

    <!-- ==================== STYLESHEET ==================== -->
    <style>
        /* ==================== BASE STYLES ==================== */
        :root {
            --primary-color: #00c6ff;
            --primary-hover: #1c78e9;
            --danger-color: #dc3545;
            --danger-hover: #c82333;
            --success-color: #28a745;
            --success-hover: #218838;
            --dark-bg: rgba(0, 0, 0, 0.7);
            --card-bg: rgba(255, 255, 255, 0.1);
            --text-light: #ffffff;
            --text-dark: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom right, rgba(0, 114, 255, 0.6), rgba(0, 198, 255, 0.6)),
                url('https://images.unsplash.com/photo-1519389950473-47ba0277781c?fit=crop&w=1650&q=80') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            color: var(--text-light);
            line-height: 1.6;
        }

        /* ==================== CONTAINERS & LAYOUT ==================== */
        .container {
            max-width: 400px;
            margin: 5% auto;
            padding: 2rem;
            background: var(--dark-bg);
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .dashboard-section {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        /* ==================== TYPOGRAPHY ==================== */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        h2 {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        p {
            margin-bottom: 1rem;
        }

        /* ==================== FORM ELEMENTS ==================== */
        input,
        select,
        textarea,
        button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        button {
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-hover);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-hover);
        }

        /* ==================== TABLE STYLES ==================== */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            color: var(--text-dark);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #007bff;
            color: white;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        /* ==================== NAVIGATION & MENU ==================== */
        .menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 28px;
            cursor: pointer;
            z-index: 1001;
            display: none;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
        }

        .side-menu {
            position: fixed;
            top: 0;
            left: -250px;
            width: 250px;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding-top: 60px;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .side-menu.open {
            transform: translateX(250px);
        }

        .side-menu a {
            display: block;
            color: white;
            padding: 12px 20px;
            text-decoration: none;
            font-size: 18px;
            border-left: 4px solid transparent;
        }

        .side-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* ==================== UTILITY CLASSES ==================== */
        .text-center {
            text-align: center;
        }

        .mt-1 {
            margin-top: 0.5rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mt-3 {
            margin-top: 1.5rem;
        }

        .mt-4 {
            margin-top: 2rem;
        }

        .mb-1 {
            margin-bottom: 0.5rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mb-3 {
            margin-bottom: 1.5rem;
        }

        .mb-4 {
            margin-bottom: 2rem;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .justify-between {
            justify-content: space-between;
        }

        .items-center {
            align-items: center;
        }

        .gap-2 {
            gap: 1rem;
        }

        /* ==================== ANNOUNCEMENT BANNER ==================== */
        .announcement-banner {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            font-weight: 500;
            padding: 10px 20px;
            border-left: 5px solid #ffc107;
            font-size: 1rem;
            overflow: hidden;
            white-space: nowrap;
            backdrop-filter: blur(6px);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
            border-radius: 6px;
            display: none;
            cursor: pointer;
        }

        .scrolling-text {
            display: inline-block;
            animation: scroll-left 18s linear infinite;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* ==================== MODAL STYLES ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 6px;
            position: relative;
            color: var(--text-dark);
        }

        .close-button {
            position: absolute;
            right: 12px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-dark);
        }

        /* ==================== RESPONSIVE STYLES ==================== */
        @media (max-width: 768px) {
            .container {
                width: 90%;
                margin: 10% auto;
            }

            .stats-container {
                flex-direction: column;
            }

            .stat-card {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- ==================== AUTHENTICATION SECTION ==================== -->
    <div class="container" id="auth-section">
        <h2 id="form-title">FreshersHub - Signup</h2>

        <div id="nameFieldContainer" style="display: none;">
            <input type="text" id="signupName" placeholder="Full Name" required />
        </div>

        <input type="email" id="email" placeholder="Email" required />

        <div class="password-wrapper">
            <input type="password" id="password" placeholder="Password" required />
            <span id="togglePasswordBtn" class="toggle-password-btn">üëÅ‚Äçüó®</span>
        </div>

        <select id="role">
            <option value="fresher">Fresher</option>
            <option value="employer">Employer</option>
        </select>

        <button id="actionBtn" class="btn-primary" onclick="signup()">Signup</button>

        <p id="toggle-text" class="text-center mt-2">
            Already have an account? <a id="toggleLink" class="text-link">Login here</a>
        </p>
    </div>

    <!-- ==================== ADMIN DASHBOARD ==================== -->
    <div id="adminDashboard" style="display:none;">
        <div id="adminMenuBtn" class="menu-btn" onclick="toggleAdminMenu()">‚ò∞</div>

        <div class="sideMenu" id="adminSideMenu">
            <a href="#" id="adminMenuHome">Dashboard</a>
            <a href="#" id="adminMenuUsers">Manage Users</a>
            <a href="#" id="adminMenuJobs">Manage Jobs</a>
            <a href="#" id="adminMenuSettings">Settings</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>

        <div class="overlay" id="adminOverlay" onclick="toggleAdminMenu()"></div>

        <!-- ==================== ADMIN HOME SECTION ==================== -->
        <div class="dashboard-section" id="adminHomeSection">
            <h2>Admin Dashboard</h2>

            <!-- Quick Actions Section -->
            <div class="card">
                <h3>Quick Actions</h3>
                <div class="flex gap-2">
                    <input type="email" id="banUserEmail" placeholder="Enter email to ban" required>
                    <button onclick="banUser()" class="btn-danger">Ban User</button>
                    <button onclick="showAnnouncementModal()" class="btn-success">Post Announcement</button>
                </div>
                <div id="banUserFeedback" style="display: none;"></div>
            </div>

            <!-- Stats Section -->
            <div class="card">
                <h3>System Statistics</h3>
                <div class="stats-container flex gap-2">
                    <div class="stat-card">
                        <p>Total Freshers</p>
                        <h3 id="totalFreshers">-</h3>
                    </div>
                    <div class="stat-card">
                        <p>Total Employers</p>
                        <h3 id="totalEmployers">-</h3>
                    </div>
                    <div class="stat-card">
                        <p>Total Jobs</p>
                        <h3 id="totalJobs">-</h3>
                    </div>
                </div>
            </div>

            <!-- Announcement Display -->
            <div class="card">
                <h3>Current Announcement</h3>
                <div id="currentAnnouncement" class="card">
                    Loading announcement...
                </div>
                <div id="announcementActions" style="display: none;" class="flex gap-2">
                    <button onclick="showAnnouncementModal()" class="btn-success">‚úèÔ∏è Edit</button>
                    <button onclick="deleteAnnouncement()" class="btn-danger">üóëÔ∏è Delete</button>
                </div>
            </div>

            <!-- Recent Activity Section -->
            <div class="card">
                <h3 class="text-center">Recent Activity</h3>
                <div class="flex gap-2">
                    <div style="flex: 1;">
                        <h4>Last 5 Users</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Email</th>
                                        <th>Role</th>
                                    </tr>
                                </thead>
                                <tbody id="recentUsersTable"></tbody>
                            </table>
                        </div>
                    </div>

                    <div style="flex: 1;">
                        <h4>Last 5 Jobs</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Employer</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tbody id="recentJobsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== MANAGE USERS SECTION ==================== -->
        <div class="dashboard-section" id="adminUsersSection">
            <div class="flex justify-between items-center mb-3">
                <h2>Manage Users</h2>
                <button onclick="showAdminSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
            </div>

            <!-- Search bar -->
            <input type="text" class="search-input" data-table-target="usersTableBody"
                placeholder="Search users by email or role...">

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllUsers" class="table-checkbox"></th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
                <div class="bulk-actions mt-2">
                    <button onclick="deleteSelectedUsers()" class="btn-danger">Delete Selected Users</button>
                </div>
            </div>

            <!-- Deleted Users Table -->
            <div class="card mt-3">
                <h3>Deleted Users</h3>
                <p class="text-muted">Click email to delete permanently from Firebase</p>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Deleted On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="deletedUsersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== MANAGE JOBS SECTION ==================== -->
        <div class="dashboard-section" id="adminJobsSection">
            <div class="flex justify-between items-center mb-3">
                <h2>Manage Job Listings</h2>
                <button onclick="showAdminSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
            </div>

            <!-- Search bar -->
            <input type="text" class="search-input" data-table-target="jobsTableBody"
                placeholder="Search jobs by title, employer...">

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllJobs" class="table-checkbox"></th>
                            <th>Title</th>
                            <th>Employer</th>
                            <th>Location</th>
                            <th>Salary</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="jobsTableBody"></tbody>
                </table>
                <div class="bulk-actions mt-2">
                    <button onclick="deleteSelectedJobs()" class="btn-danger">Delete Selected Jobs</button>
                </div>
            </div>
        </div>

        <!-- ==================== SETTINGS SECTION ==================== -->
        <div class="dashboard-section" id="adminSettingsSection">
            <div class="flex justify-between items-center mb-3">
                <h2>Admin Settings</h2>
                <button onclick="showAdminSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
            </div>

            <div class="card">
                <h3>System Configuration</h3>

                <!-- Current Admins table -->
                <div id="adminSection">
                    <h3>Current Admins</h3>
                    <div class="table-container">
                        <table id="adminTable">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="adminTableBody"></tbody>
                        </table>
                    </div>

                    <!-- Promote user to admin form -->
                    <div id="addAdminSection" style="display: none;" class="mt-3">
                        <h3>Promote User to Admin</h3>
                        <div class="flex gap-2">
                            <input type="email" id="promoteEmail" placeholder="Enter user email">
                            <button onclick="promoteToAdmin()" class="btn-primary">Promote</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Banned users table -->
            <div class="card mt-3">
                <h3>Banned Users</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Banned On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bannedUsersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== EMPLOYER DASHBOARD ==================== -->
    <div id="employerDashboard" style="display:none;">
        <div id="announcementBannerEmployer" class="announcement-banner" style="display: none;"
            onclick="showFullAnnouncement()">
            <div class="scrolling-text" id="announcementTextEmployer"></div>
        </div>

        <div id="employerMenuBtn" class="menu-btn" onclick="toggleEmployerMenu()">‚ò∞</div>

        <div class="sideMenu" id="employerSideMenu">
            <a href="#" id="employerMenuHome">Dashboard</a>
            <a href="#" id="employerMenuPostJob">Post Job</a>
            <a href="#" id="employerMenuMyJobs">My Jobs</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>

        <div class="overlay" id="employerOverlay" onclick="toggleEmployerMenu()"></div>

        <!-- ==================== EMPLOYER HOME SECTION ==================== -->
        <div class="dashboard-section" id="employerHomeSection">
            <h2>Employer Dashboard</h2>

            <!-- Quick Stats -->
            <div class="card">
                <h3>Job Statistics</h3>
                <div class="stats-container flex gap-2">
                    <div class="stat-card" onclick="showEmployerSection('myJobs')">
                        <p>Active Jobs</p>
                        <h3 id="employerActiveJobCount">-</h3>
                    </div>
                    <div class="stat-card" onclick="showEmployerSection('myJobs')">
                        <p>Total Jobs</p>
                        <h3 id="employerTotalJobCount">-</h3>
                    </div>
                    <div class="stat-card" onclick="loadApplicationsStats()">
                        <p>Total Applications</p>
                        <h3 id="employerAppCount">-</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== POST JOB SECTION ==================== -->
        <div class="dashboard-section" id="employerPostJobSection">
            <div class="flex justify-between items-center mb-3">
                <h2>Post New Job</h2>
                <button onclick="showEmployerSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
            </div>

            <div class="card">
                <form id="postJobForm">
                    <input type="text" id="jobTitle" placeholder="Job Title" required>
                    <textarea id="jobDescription" placeholder="Job Description (Responsibilities, Requirements)"
                        required></textarea>
                    <input type="text" id="jobLocation" placeholder="Location (e.g., Remote, City)" required>
                    <input type="text" id="jobSalary" placeholder="Salary Range (e.g., $50k-$70k)" required>
                    <select id="jobType" required>
                        <option value="">Select Job Type</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Internship">Internship</option>
                    </select>
                    <button type="submit" class="btn-success">Post Job</button>
                </form>
            </div>
        </div>

        <!-- ==================== MY JOBS SECTION ==================== -->
        <div class="dashboard-section" id="employerMyJobsSection">
            <div class="flex justify-between items-center mb-3">
                <button onclick="showEmployerSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
                <input type="text" class="search-input" placeholder="Search my jobs..." id="searchMyJobs">
            </div>

            <div class="table-container">
                <table id="employerJobsTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Applications</th>
                            <th>Type</th>
                            <th>Posted</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employerJobsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== FRESHER DASHBOARD ==================== -->
    <div id="fresherDashboard" style="display:none;">
        <div id="announcementBannerFresher" class="announcement-banner" style="display: none;"
            onclick="showFullAnnouncement()">
            <div class="scrolling-text" id="announcementTextFresher"></div>
        </div>

        <div id="fresherMenuBtn" class="menu-btn" onclick="toggleFresherMenu()">‚ò∞</div>

        <div class="sideMenu" id="fresherSideMenu">
            <a href="#" id="fresherMenuHome">Dashboard</a>
            <a href="#" id="fresherMenuJobs">Browse Jobs</a>
            <a href="#" id="fresherMenuApplications">My Applications</a>
            <a href="#" id="fresherMenuProfile">Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>

        <div class="overlay" id="fresherOverlay" onclick="toggleFresherMenu()"></div>

        <div id="fresherMainContent">
            <!-- ==================== FRESHER HOME SECTION ==================== -->
            <div class="dashboard-section" id="fresherHomeSection">
                <h2>Fresher Dashboard</h2>
                <div class="card">
                    <p>Welcome to your job search dashboard!</p>
                </div>
            </div>

            <!-- ==================== BROWSE JOBS SECTION ==================== -->
            <div class="dashboard-section" id="fresherJobsSection">
                <div class="flex justify-between items-center mb-3">
                    <h2>Available Jobs</h2>
                    <button onclick="showFresherSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
                </div>

                <div class="table-container">
                    <table id="availableJobsTable">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Employer</th>
                                <th>Location</th>
                                <th>Salary</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="availableJobsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- ==================== MY APPLICATIONS SECTION ==================== -->
            <div class="dashboard-section" id="fresherApplicationsSection">
                <div class="flex justify-between items-center mb-3">
                    <h2>My Applications</h2>
                    <button onclick="showFresherSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Job Title</th>
                                <th>Employer</th>
                                <th>Status</th>
                                <th>Applied On</th>
                            </tr>
                        </thead>
                        <tbody id="myApplicationsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- ==================== PROFILE SECTION ==================== -->
            <div class="dashboard-section" id="fresherProfileSection">
                <div class="flex justify-between items-center mb-3">
                    <h2>My Profile</h2>
                    <button onclick="showFresherSection('home')" class="btn-primary">‚Üê Back to Dashboard</button>
                </div>

                <div class="card">
                    <form id="fresherProfileForm">
                        <input type="text" id="fullName" placeholder="Full Name" required>
                        <input type="text" id="education" placeholder="Education" required>
                        <textarea id="skills" placeholder="Skills (comma separated)" required></textarea>
                        <input type="file" id="resume" accept=".pdf,.doc,.docx">
                        <button type="submit" class="btn-success">Update Profile</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODALS ==================== -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeJobModal()">&times;</span>
            <h3 id="modalJobTitle">Job Title</h3>
            <p id="modalJobDescription">Description here...</p>
            <p><strong>Location:</strong> <span id="modalJobLocation"></span></p>
            <p><strong>Salary:</strong> <span id="modalJobSalary"></span></p>
            <p><strong>Type:</strong> <span id="modalJobType"></span></p>
            <button onclick="closeJobModal()" class="btn-primary">Close</button>
        </div>
    </div>

    <div id="editJobModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeEditJobModal()">&times;</span>
            <h2>Edit Job</h2>
            <form id="editJobForm">
                <input type="hidden" id="editJobId" />
                <div class="form-group">
                    <label for="editTitle">Title</label>
                    <input type="text" id="editTitle" required />
                </div>
                <div class="form-group">
                    <label for="editDescription">Description</label>
                    <textarea id="editDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editLocation">Location</label>
                    <input type="text" id="editLocation" required />
                </div>
                <div class="form-group">
                    <label for="editSalary">Salary</label>
                    <input type="text" id="editSalary" required />
                </div>
                <div class="form-group">
                    <label for="editJobType">Type</label>
                    <select id="editJobType">
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editStatus">Status</label>
                    <select id="editStatus">
                        <option value="active">Active</option>
                        <option value="closed">Closed</option>
                    </select>
                </div>
                <div class="flex justify-between mt-3">
                    <button type="submit" class="btn-success">Save Changes</button>
                    <button type="button" onclick="closeEditJobModal()" class="btn-danger">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="applyModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeApplyModal()">&times;</span>
            <h2>Apply for Job</h2>
            <form id="applyForm">
                <input type="hidden" id="applyJobId" />
                <div class="form-group">
                    <label for="applyApplicantName">Name</label>
                    <input type="text" id="applyApplicantName" required />
                </div>
                <div class="form-group">
                    <label for="resumeFile">Upload Resume (PDF or DOC)</label>
                    <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" required />
                    <div id="uploadStatus" class="text-muted"></div>
                </div>
                <div class="form-group">
                    <label for="applyMessage">Message</label>
                    <textarea id="applyMessage" required></textarea>
                </div>
                <button type="submit" class="btn-success">Submit Application</button>
            </form>
        </div>
    </div>

    <!-- ==================== TOAST NOTIFICATION ==================== -->
    <div id="toastContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>

    <!-- ==================== FIREBASE INITIALIZATION ==================== -->
    <script type="module">
        import {
            getStorage,
            ref,
            uploadBytes,
            getDownloadURL
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import {
            getFirestore,
            setDoc,
            doc,
            getDoc,
            collection,
            where,
            getDocs,
            query,
            addDoc,
            deleteDoc,
            updateDoc,
            onSnapshot,
            orderBy
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDrrAYywpFdd9iIzSSp2m6XcrGkGUgYY3Y",
            authDomain: "freshershub-33de8.firebaseapp.com",
            projectId: "freshershub-33de8",
            storageBucket: "freshershub-33de8.appspot.com",
            messagingSenderId: "126389629687",
            appId: "1:126389629687:web:9b9fb43e488f60ac3159f2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ==================== GLOBAL VARIABLES ====================
        let roleChangeUnsubscribe = null;
        const ORIGINAL_ADMIN_EMAIL = "gauravku7409@gmail.com";

        // ==================== UTILITY FUNCTIONS ====================
        function normalizeString(str) {
            return str ? str.toLowerCase().trim() : "";
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePassword(password) {
            return password && password.length >= 8;
        }

        function capitalize(text) {
            if (!text || typeof text !== "string") return "";
            return text.charAt(0).toUpperCase() + text.slice(1);
        }

        function showToast(message, type = "info") {
            const container = document.getElementById("toastContainer");
            if (!container) return;

            const toast = document.createElement("div");
            toast.textContent = message;
            toast.style.background = type === "error" ? "#dc3545" : "#323232";
            toast.style.color = "#fff";
            toast.style.padding = "10px 20px";
            toast.style.marginTop = "10px";
            toast.style.borderRadius = "6px";
            toast.style.boxShadow = "0 2px 6px rgba(0,0,0,0.3)";
            toast.style.fontSize = "14px";
            toast.style.transition = "opacity 0.5s ease";

            container.appendChild(toast);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = "0";
                setTimeout(() => container.removeChild(toast), 500);
            }, 3000);
        }

        // ==================== AUTHENTICATION FUNCTIONS ====================
        window.signup = async function () {
            const email = document.getElementById('email').value.trim();
            const name = document.getElementById("signupName").value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            if (!validateEmail(email)) {
                showToast("Please enter a valid email address", "error");
                return;
            }

            if (!validatePassword(password)) {
                showToast("Password must be at least 8 characters long", "error");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await setDoc(doc(db, "users", user.uid), {
                    email,
                    role: normalizeString(role),
                    name: name,
                    createdAt: new Date().toISOString(),
                    isOriginalAdmin: normalizeString(email) === normalizeString(ORIGINAL_ADMIN_EMAIL)
                });

                showToast("Signup successful!");
                showDashboard(role);
            } catch (err) {
                showToast(err.message, "error");
            }
        };

        window.login = async function () {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!validateEmail(email)) {
                showToast("Please enter a valid email address", "error");
                return;
            }

            try {
                if (roleChangeUnsubscribe) {
                    roleChangeUnsubscribe();
                }

                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const userData = docSnap.data();

                    if (userData.banned) {
                        showToast("Your account has been banned. Contact support.", "error");
                        await signOut(auth);
                        return;
                    }

                    const initialRole = userData.role;
                    showDashboard(initialRole);
                    startUserAnnouncementListener();

                    roleChangeUnsubscribe = onSnapshot(docRef, (snapshot) => {
                        const data = snapshot.data();
                        if (data?.banned) {
                            showToast("You have been banned. You are now logged out.", "error");
                            logout();
                            return;
                        }

                        const newRole = data?.role;
                        if (newRole !== initialRole) {
                            showToast("Your role has changed. You'll be logged out.", "error");
                            logout();
                        }
                    });
                } else {
                    showToast("User data not found.", "error");
                }
            } catch (err) {
                showToast(err.message, "error");
            }
        };

        window.logout = function () {
            if (roleChangeUnsubscribe) {
                roleChangeUnsubscribe();
                roleChangeUnsubscribe = null;
            }

            signOut(auth).then(() => {
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('adminDashboard').style.display = 'none';
                document.getElementById('employerDashboard').style.display = 'none';
                document.getElementById('fresherDashboard').style.display = 'none';
            });
        };

        // ==================== FORM TOGGLE FUNCTION ====================
        window.toggleForm = function () {
            const formTitle = document.getElementById('form-title');
            const actionBtn = document.getElementById('actionBtn');
            const toggleText = document.getElementById('toggle-text');
            const nameField = document.getElementById('nameFieldContainer');
            const roleSelect = document.getElementById('role');

            if (formTitle.textContent.includes('Signup')) {
                formTitle.textContent = 'FreshersHub - Login';
                actionBtn.textContent = 'Login';
                actionBtn.onclick = login;
                toggleText.innerHTML = `Don't have an account? <a id="toggleLink">Signup here</a>`;
                roleSelect.style.display = 'none';
                nameField.style.display = 'none';
            } else {
                formTitle.textContent = 'FreshersHub - Signup';
                actionBtn.textContent = 'Signup';
                actionBtn.onclick = signup;
                toggleText.innerHTML = `Already have an account? <a id="toggleLink">Login here</a>`;
                roleSelect.style.display = 'block';
                nameField.style.display = 'block';
            }
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        window.showDashboard = function (role) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('employerDashboard').style.display = 'none';
            document.getElementById('fresherDashboard').style.display = 'none';

            document.getElementById('adminMenuBtn').style.display = 'none';
            document.getElementById('employerMenuBtn').style.display = 'none';
            document.getElementById('fresherMenuBtn').style.display = 'none';

            role = normalizeString(role);

            if (role === 'admin') {
                document.getElementById('adminDashboard').style.display = 'block';
                document.getElementById('adminMenuBtn').style.display = 'block';
                showAdminSection('home');
                loadAdminStats();
                loadRecentActivity();
            } else if (role === 'employer') {
                document.getElementById('employerDashboard').style.display = 'block';
                document.getElementById('employerMenuBtn').style.display = 'block';
                showEmployerSection('home');
            } else if (role === 'fresher') {
                document.getElementById('fresherDashboard').style.display = 'block';
                document.getElementById('fresherMenuBtn').style.display = 'block';
                showFresherSection('home');
            }
        };

        // ==================== MENU TOGGLE FUNCTIONS ====================
        window.toggleAdminMenu = function () {
            document.getElementById('adminSideMenu').classList.toggle('open');
            document.getElementById('adminOverlay').classList.toggle('show');
        };

        window.toggleEmployerMenu = function () {
            document.getElementById('employerSideMenu').classList.toggle('open');
            document.getElementById('employerOverlay').classList.toggle('show');
        };

        window.toggleFresherMenu = function () {
            document.getElementById('fresherSideMenu').classList.toggle('open');
            document.getElementById('fresherOverlay').classList.toggle('show');
        };

        // ==================== ADMIN SECTION FUNCTIONS ====================
        window.showAdminSection = function (section) {
            document.getElementById('adminHomeSection').style.display = 'none';
            document.getElementById('adminUsersSection').style.display = 'none';
            document.getElementById('adminJobsSection').style.display = 'none';
            document.getElementById('adminSettingsSection').style.display = 'none';

            if (section === 'home') {
                document.getElementById('adminHomeSection').style.display = 'block';
                loadAdminStats();
                loadRecentActivity();
                loadAnnouncement();
            } else if (section === 'users') {
                document.getElementById('adminUsersSection').style.display = 'block';
                loadAllUsers();
                loadDeletedUsers();
            } else if (section === 'jobs') {
                document.getElementById('adminJobsSection').style.display = 'block';
                loadAllJobs();
            } else if (section === 'settings') {
                document.getElementById('adminSettingsSection').style.display = 'block';
                loadAdminManagement();
                loadBannedUsers();
            }
        };

        window.loadAllUsers = function () {
            const table = document.getElementById('usersTableBody');
            if (!table) return;

            table.innerHTML = '<tr><td colspan="4">Loading users...</td></tr>';

            const q = query(collection(db, "users"));

            let knownUserIds = new Set();
            let initialLoadComplete = false;

            onSnapshot(q, (snapshot) => {
                table.innerHTML = '';

                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.isOriginalAdmin) return;

                    const isNew = !knownUserIds.has(doc.id);
                    knownUserIds.add(doc.id);

                    if (initialLoadComplete && isNew && data.role?.toLowerCase() === 'employer') {
                        showToast(`üéâ New Employer Joined: ${data.email}`);
                    }

                    const row = `
                    <tr>
                        <td><input type="checkbox" class="user-checkbox" data-id="${doc.id}"></td>
                        <td>${data.email}</td>
                        <td>${data.role}</td>
                        <td>
                            <button onclick="deleteUser('${doc.id}')" class="btn-danger">Delete</button>
                        </td>
                    </tr>`;
                    table.innerHTML += row;
                });

                initialLoadComplete = true;
            }, (error) => {
                console.error("Error loading users:", error);
                table.innerHTML = '<tr><td colspan="4">Error loading users</td></tr>';
            });
        };

        window.loadAllJobs = function () {
            const table = document.getElementById('jobsTableBody');
            if (!table) return;

            table.innerHTML = '<tr><td colspan="6">Loading jobs...</td></tr>';

            const q = query(collection(db, "jobs"));

            onSnapshot(q, (snapshot) => {
                table.innerHTML = '';

                if (snapshot.empty) {
                    table.innerHTML = '<tr><td colspan="6">No jobs found</td></tr>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = `
                    <tr>
                        <td><input type="checkbox" class="job-checkbox" data-id="${doc.id}"></td>
                        <td>${capitalize(data.title || 'N/A')}</td>
                        <td>${data.employerEmail || 'N/A'}</td>
                        <td>${capitalize(data.location || 'N/A')}</td>
                        <td>${data.salary || 'N/A'}</td>
                        <td>
                            <button onclick="deleteJob('${doc.id}')" class="btn-danger">Delete</button>
                        </td>
                    </tr>`;
                    table.innerHTML += row;
                });
            }, (error) => {
                console.error("Error loading jobs:", error);
                table.innerHTML = '<tr><td colspan="6">Error loading jobs</td></tr>';
            });
        };

        // ==================== USER MANAGEMENT FUNCTIONS ====================
        window.deleteUser = async function (userId) {
            if (!confirm("Are you sure you want to delete this user?")) return;

            try {
                const user = auth.currentUser;
                if (!user) throw new Error("Not authenticated");

                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (!userDoc.exists() || normalizeString(userDoc.data().role) !== 'admin') {
                    throw new Error("Admin privileges required");
                }

                const userRef = doc(db, "users", userId);
                const userSnap = await getDoc(userRef);

                if (!userSnap.exists()) {
                    showToast("User not found", "error");
                    return;
                }

                const userData = userSnap.data();

                await deleteDoc(userRef);

                await setDoc(doc(db, "deleted_users", userId), {
                    email: userData.email,
                    role: userData.role,
                    deletedAt: new Date().toISOString(),
                    deletedBy: user.email,
                    originalId: userId
                });

                showToast("User moved to deleted users successfully!");
                loadAllUsers();
                loadDeletedUsers();
            } catch (error) {
                console.error("Delete error:", error);
                showToast("Error: " + error.message, "error");
            }
        };

        window.confirmFullDeletion = async function (docId, email) {
            if (!confirm(`Have you already deleted ${email} from Firebase Authentication? This will remove the record completely.`)) {
                return;
            }

            try {
                await deleteDoc(doc(db, "deleted_users", docId));
                showToast("Record cleaned up successfully!");
                loadDeletedUsers();
            } catch (error) {
                showToast("Error removing record: " + error.message, "error");
            }
        };

        // ==================== JOB MANAGEMENT FUNCTIONS ====================
        window.deleteJob = async function (jobId) {
            if (!confirm("Are you sure you want to delete this job?")) return;

            try {
                const user = auth.currentUser;
                const userDoc = await getDoc(doc(db, "users", user.uid));

                if (!userDoc.exists() || normalizeString(userDoc.data().role) !== 'admin') {
                    throw new Error("Admin privileges required");
                }

                await deleteDoc(doc(db, "jobs", jobId));
                showToast("Job deleted successfully");
                loadAllJobs();
            } catch (error) {
                showToast("Error deleting job: " + error.message, "error");
            }
        };

        // ==================== ADMIN MANAGEMENT FUNCTIONS ====================
        window.promoteToAdmin = async function () {
            const email = document.getElementById('promoteEmail').value.trim();
            const currentUser = auth.currentUser;

            if (!email) {
                showToast("Please enter a valid email", "error");
                return;
            }

            try {
                const currentUserDoc = await getDoc(doc(db, "users", currentUser.uid));
                if (!currentUserDoc.data().isOriginalAdmin) {
                    showToast("Only original admin can promote users", "error");
                    return;
                }

                const usersSnapshot = await getDocs(query(
                    collection(db, "users"),
                    where("email", "==", email)
                ));

                if (usersSnapshot.empty) {
                    showToast("User not found", "error");
                    return;
                }

                const userDoc = usersSnapshot.docs[0];
                const userData = userDoc.data();

                if (normalizeString(userData.role) === 'admin') {
                    showToast("User is already an admin", "error");
                    return;
                }

                await updateDoc(userDoc.ref, {
                    role: "admin"
                });

                showToast("User promoted to admin successfully");
                document.getElementById('promoteEmail').value = "";
                loadAdminManagement();
            } catch (err) {
                showToast("Error promoting user: " + err.message, "error");
            }
        };

        window.banUser = async function () {
            const email = document.getElementById('banUserEmail').value.trim();
            if (!email) {
                showToast("Please enter an email", "error");
                return;
            }

            try {
                const currentUser = auth.currentUser;
                if (!currentUser) throw new Error("Not authenticated");

                const currentUserDoc = await getDoc(doc(db, "users", currentUser.uid));
                if (!currentUserDoc.exists() || normalizeString(currentUserDoc.data().role) !== 'admin') {
                    throw new Error("Admin privileges required");
                }

                const userToBanQuery = query(collection(db, "users"), where("email", "==", email));
                const querySnapshot = await getDocs(userToBanQuery);

                if (querySnapshot.empty) {
                    showToast("User not found", "error");
                    return;
                }

                const userDoc = querySnapshot.docs[0];
                const userData = userDoc.data();

                if (userData.isOriginalAdmin) {
                    throw new Error("Cannot ban original admin");
                }

                await setDoc(userDoc.ref, {
                    banned: true,
                    bannedAt: new Date().toISOString(),
                    bannedBy: currentUser.email
                }, { merge: true });

                showToast(`User ${email} has been banned`);
                document.getElementById('banUserEmail').value = "";
                loadBannedUsers();
            } catch (error) {
                console.error("Ban error:", error);
                showToast("Error: " + error.message, "error");
            }
        };

        // ==================== ANNOUNCEMENT FUNCTIONS ====================
        window.postAnnouncement = async function (text) {
            if (!text || text.trim() === "") {
                showToast("Please enter announcement text", "error");
                return;
            }

            try {
                const user = auth.currentUser;
                if (!user) throw new Error("Not authenticated");

                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);
                if (!userDoc.exists()) throw new Error("User not found");

                const userData = userDoc.data();

                if (!userData.isOriginalAdmin) {
                    throw new Error("Only original admin can post announcements");
                }

                const authorRole = userData.role ? userData.role.charAt(0).toUpperCase() + userData.role.slice(1) : "Admin";

                await setDoc(doc(db, "announcements", "current"), {
                    text: text.trim(),
                    timestamp: new Date().toISOString(),
                    author: authorRole,
                    authorId: user.uid
                });

                showToast("Announcement posted successfully!");
                loadAnnouncement();
            } catch (err) {
                console.error("Announcement error:", err);
                showToast("Failed to post announcement: " + err.message, "error");
            }
        };

        window.showAnnouncementModal = async function () {
            const user = auth.currentUser;
            const userDoc = await getDoc(doc(db, "users", user.uid));

            if (!userDoc.data().isOriginalAdmin) {
                showToast("Only original admin can post announcements", "error");
                return;
            }

            const text = prompt("Enter announcement text:");
            if (text) {
                postAnnouncement(text);
            }
        };

        window.deleteAnnouncement = async function () {
            if (!confirm("Are you sure you want to delete the current announcement?")) return;

            try {
                await deleteDoc(doc(db, "announcements", "current"));
                showToast("Announcement deleted.");
                loadAnnouncement();
            } catch (err) {
                console.error("Delete error:", err);
                showToast("Failed to delete announcement: " + err.message, "error");
            }
        };

        window.showFullAnnouncement = async function () {
            const snap = await getDoc(doc(db, "announcements", "current"));
            const data = snap.exists() ? snap.data() : null;
            const fullText = data?.text || "No announcement.";

            alert("üì¢ Announcement:\n\n" + fullText);
        };

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Toggle between login/signup forms
            document.getElementById('toggleLink').addEventListener('click', (e) => {
                e.preventDefault();
                toggleForm();
            });

            // Password Toggle
            const toggleBtn = document.getElementById('togglePasswordBtn');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    const passwordInput = document.getElementById('password');
                    if (passwordInput) {
                        passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
                    }
                });
            }

            // Initialize auth state listener
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    document.getElementById('auth-section').style.display = 'block';
                    return;
                }

                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();

                        if (userData.banned) {
                            showToast("Your account has been banned.", "error");
                            await signOut(auth);
                            return;
                        }

                        showDashboard(userData.role);
                        startUserAnnouncementListener();

                        if (roleChangeUnsubscribe) {
                            roleChangeUnsubscribe();
                        }

                        roleChangeUnsubscribe = onSnapshot(userDoc.ref, (snapshot) => {
                            const newData = snapshot.data();
                            if (newData?.banned) {
                                showToast("You have been banned. You are now logged out.", "error");
                                logout();
                                return;
                            }

                            const newRole = newData?.role;
                            if (newRole !== userData.role) {
                                showToast("Your role has changed. Please log in again.", "error");
                                logout();
                            }
                        });
                    }
                } catch (error) {
                    console.error("Error checking user role:", error);
                    showToast("Error loading user data. Please try again.", "error");
                }
            });
        });

        function startUserAnnouncementListener() {
    const announcementRef = doc(db, "announcements", "current");

    onSnapshot(announcementRef, (docSnap) => {
        const data = docSnap.data();
        const text = data?.text?.trim();
        const isActive = !!text;

        // Update fresher banner
        const fresherBanner = document.getElementById("announcementBannerFresher");
        const fresherText = document.getElementById("announcementTextFresher");
        if (fresherBanner && fresherText) {
            fresherBanner.style.display = isActive ? "block" : "none";
            fresherText.textContent = text || "";
        }

        // Update employer banner
        const employerBanner = document.getElementById("announcementBannerEmployer");
        const employerText = document.getElementById("announcementTextEmployer");
        if (employerBanner && employerText) {
            employerBanner.style.display = isActive ? "block" : "none";
            employerText.textContent = text || "";
        }

        // Update admin announcement display
        const announcementDiv = document.getElementById("currentAnnouncement");
        const actionsDiv = document.getElementById("announcementActions");
        if (announcementDiv && actionsDiv) {
            if (docSnap.exists()) {
                announcementDiv.innerHTML = `
                    <p><strong>${data.text || "No text"}</strong></p>
                    <small>Posted by ${data.author || "Admin"} on ${
                        data.timestamp ? new Date(data.timestamp).toLocaleString() : "Unknown date"
                    }</small>
                `;

                // Only show actions if user is original admin
                if (auth.currentUser?.uid === data.authorId) {
                    actionsDiv.style.display = "block";
                } else {
                    actionsDiv.style.display = "none";
                }
            } else {
                announcementDiv.innerHTML = "No active announcements.";
                actionsDiv.style.display = "none";
            }
        }
    });
}
    </script>
</body>

</html>
